{% extends "base.html" %}

{% block title %}Production Engineering - PetroCalc Web{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <div class="d-flex align-items-center mb-4">
            <i class="fas fa-industry fa-2x text-warning me-3"></i>
            <div>
                <h1 class="mb-0">Production Engineering</h1>
                <p class="text-muted mb-0">Well performance and production optimization</p>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <!-- Vogel IPR -->
    <div class="col-lg-6 mb-4">
        <div class="card">
            <div class="card-header bg-warning text-dark">
                <h5 class="mb-0"><i class="fas fa-chart-line me-2"></i>Vogel IPR</h5>
            </div>
            <div class="card-body">
                <form id="vogelIPRForm">
                    <div class="mb-3">
                        <label for="reservoir_pressure" class="form-label">Reservoir Pressure (psia)</label>
                        <input type="number" class="form-control" id="reservoir_pressure" step="0.01" required>
                    </div>
                    <div class="mb-3">
                        <label for="bottomhole_pressure" class="form-label">Bottomhole Pressure (psia)</label>
                        <input type="number" class="form-control" id="bottomhole_pressure" step="0.01" required>
                    </div>
                    <div class="mb-3">
                        <label for="maximum_oil_rate" class="form-label">Maximum Oil Rate (STB/day)</label>
                        <input type="number" class="form-control" id="maximum_oil_rate" step="0.01" required>
                    </div>
                    <button type="submit" class="btn btn-warning">Calculate</button>
                </form>
                <div id="vogelIPRResult" class="mt-3" style="display: none;">
                    <div class="alert alert-success">
                        <h6>Result:</h6>
                        <p class="mb-0"><strong>Flow Rate:</strong> <span id="vogelFlowRate"></span> STB/day</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Productivity Index -->
    <div class="col-lg-6 mb-4">
        <div class="card">
            <div class="card-header bg-warning text-dark">
                <h5 class="mb-0"><i class="fas fa-tachometer-alt me-2"></i>Productivity Index</h5>
            </div>
            <div class="card-body">
                <form id="productivityIndexForm">
                    <div class="mb-3">
                        <label for="pi_flow_rate" class="form-label">Flow Rate (STB/day)</label>
                        <input type="number" class="form-control" id="pi_flow_rate" step="0.01" required>
                    </div>
                    <div class="mb-3">
                        <label for="pi_reservoir_pressure" class="form-label">Reservoir Pressure (psia)</label>
                        <input type="number" class="form-control" id="pi_reservoir_pressure" step="0.01" required>
                    </div>
                    <div class="mb-3">
                        <label for="pi_bottomhole_pressure" class="form-label">Bottomhole Pressure (psia)</label>
                        <input type="number" class="form-control" id="pi_bottomhole_pressure" step="0.01" required>
                    </div>
                    <button type="submit" class="btn btn-warning">Calculate</button>
                </form>
                <div id="productivityIndexResult" class="mt-3" style="display: none;">
                    <div class="alert alert-success">
                        <h6>Result:</h6>
                        <p class="mb-0"><strong>Productivity Index:</strong> <span id="productivityIndexValue"></span> STB/day/psi</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Darcy Radial Flow -->
    <div class="col-lg-6 mb-4">
        <div class="card">
            <div class="card-header bg-warning text-dark">
                <h5 class="mb-0"><i class="fas fa-circle-notch me-2"></i>Darcy Radial Flow</h5>
            </div>
            <div class="card-body">
                <form id="darcyRadialForm">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="permeability" class="form-label">Permeability (md)</label>
                                <input type="number" class="form-control" id="permeability" step="0.01" required>
                            </div>
                            <div class="mb-3">
                                <label for="thickness" class="form-label">Thickness (ft)</label>
                                <input type="number" class="form-control" id="thickness" step="0.01" required>
                            </div>
                            <div class="mb-3">
                                <label for="pressure_drop" class="form-label">Pressure Drop (psi)</label>
                                <input type="number" class="form-control" id="pressure_drop" step="0.01" required>
                            </div>
                            <div class="mb-3">
                                <label for="viscosity" class="form-label">Viscosity (cp)</label>
                                <input type="number" class="form-control" id="viscosity" step="0.01" required>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="formation_volume_factor" class="form-label">Formation Volume Factor</label>
                                <input type="number" class="form-control" id="formation_volume_factor" step="0.01" required>
                            </div>
                            <div class="mb-3">
                                <label for="wellbore_radius" class="form-label">Wellbore Radius (ft)</label>
                                <input type="number" class="form-control" id="wellbore_radius" step="0.01" required>
                            </div>
                            <div class="mb-3">
                                <label for="drainage_radius" class="form-label">Drainage Radius (ft)</label>
                                <input type="number" class="form-control" id="drainage_radius" step="0.01" required>
                            </div>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-warning">Calculate</button>
                </form>
                <div id="darcyRadialResult" class="mt-3" style="display: none;">
                    <div class="alert alert-success">
                        <h6>Result:</h6>
                        <p class="mb-0"><strong>Flow Rate:</strong> <span id="darcyFlowRate"></span> STB/day</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Gas Well Deliverability -->
    <div class="col-lg-6 mb-4">
        <div class="card">
            <div class="card-header bg-warning text-dark">
                <h5 class="mb-0"><i class="fas fa-fire me-2"></i>Gas Well Deliverability</h5>
            </div>
            <div class="card-body">
                <form id="gasDeliverabilityForm">
                    <div class="mb-3">
                        <label for="max_flow_rate" class="form-label">Maximum Flow Rate (Mscf/day)</label>
                        <input type="number" class="form-control" id="max_flow_rate" step="0.01" required>
                    </div>
                    <div class="mb-3">
                        <label for="test_flow_rate" class="form-label">Test Flow Rate (Mscf/day)</label>
                        <input type="number" class="form-control" id="test_flow_rate" step="0.01" required>
                    </div>
                    <div class="mb-3">
                        <label for="flowing_bhp" class="form-label">Flowing BHP (psia)</label>
                        <input type="number" class="form-control" id="flowing_bhp" step="0.01" required>
                    </div>
                    <div class="mb-3">
                        <label for="gas_reservoir_pressure" class="form-label">Reservoir Pressure (psia)</label>
                        <input type="number" class="form-control" id="gas_reservoir_pressure" step="0.01" required>
                    </div>
                    <div class="mb-3">
                        <label for="flow_exponent" class="form-label">Flow Exponent (n)</label>
                        <input type="number" class="form-control" id="flow_exponent" step="0.01" value="0.5">
                    </div>
                    <button type="submit" class="btn btn-warning">Calculate</button>
                </form>
                <div id="gasDeliverabilityResult" class="mt-3" style="display: none;">
                    <div class="alert alert-success">
                        <h6>Result:</h6>
                        <p class="mb-0"><strong>Gas Flow Rate:</strong> <span id="gasFlowRate"></span> Mscf/day</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row mt-4">
    <div class="col-lg-6">
        <div class="card bg-light">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-info-circle me-2"></i>Available Modules</h5>
            </div>
            <div class="card-body">
                <p>While this module is under development, you can use these available modules:</p>
                <div class="d-grid gap-2">
                    <a href="/drilling" class="btn btn-primary">
                        <i class="fas fa-drill me-2"></i>Drilling Calculations
                    </a>
                    <a href="/fluids" class="btn btn-info">
                        <i class="fas fa-flask me-2"></i>Fluid Properties
                    </a>
                    <a href="/reservoir" class="btn btn-success">
                        <i class="fas fa-layer-group me-2"></i>Reservoir Engineering
                    </a>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-lg-6">
        <div class="card">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0"><i class="fas fa-code me-2"></i>API Available</h5>
            </div>
            <div class="card-body">
                <p>The API endpoint for production calculations is available:</p>
                <code>/api/production/*</code>
                <p class="mt-3">
                    <a href="/api/docs" target="_blank" class="btn btn-outline-primary">
                        <i class="fas fa-external-link-alt me-2"></i>View API Documentation
                    </a>
                </p>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// Vogel IPR Form
document.getElementById('vogelIPRForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const data = {
        reservoir_pressure: parseFloat(document.getElementById('reservoir_pressure').value),
        bottomhole_pressure: parseFloat(document.getElementById('bottomhole_pressure').value),
        maximum_oil_rate: parseFloat(document.getElementById('maximum_oil_rate').value)
    };
    
    try {
        const response = await fetch('/api/production/vogel_ipr', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(data)
        });
        
        const result = await response.json();
        
        if (response.ok) {
            document.getElementById('vogelFlowRate').textContent = result.flow_rate_stb_per_day.toFixed(2);
            document.getElementById('vogelIPRResult').style.display = 'block';
        } else {
            alert('Error: ' + result.detail);
        }
    } catch (error) {
        alert('Error: ' + error.message);
    }
});

// Productivity Index Form
document.getElementById('productivityIndexForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const data = {
        flow_rate: parseFloat(document.getElementById('pi_flow_rate').value),
        reservoir_pressure: parseFloat(document.getElementById('pi_reservoir_pressure').value),
        bottomhole_pressure: parseFloat(document.getElementById('pi_bottomhole_pressure').value)
    };
    
    try {
        const response = await fetch('/api/production/productivity_index', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(data)
        });
        
        const result = await response.json();
        
        if (response.ok) {
            document.getElementById('productivityIndexValue').textContent = result.productivity_index_stb_per_day_per_psi.toFixed(4);
            document.getElementById('productivityIndexResult').style.display = 'block';
        } else {
            alert('Error: ' + result.detail);
        }
    } catch (error) {
        alert('Error: ' + error.message);
    }
});

// Darcy Radial Flow Form
document.getElementById('darcyRadialForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const data = {
        permeability: parseFloat(document.getElementById('permeability').value),
        thickness: parseFloat(document.getElementById('thickness').value),
        pressure_drop: parseFloat(document.getElementById('pressure_drop').value),
        viscosity: parseFloat(document.getElementById('viscosity').value),
        formation_volume_factor: parseFloat(document.getElementById('formation_volume_factor').value),
        wellbore_radius: parseFloat(document.getElementById('wellbore_radius').value),
        drainage_radius: parseFloat(document.getElementById('drainage_radius').value)
    };
    
    try {
        const response = await fetch('/api/production/darcy_radial_flow', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(data)
        });
        
        const result = await response.json();
        
        if (response.ok) {
            document.getElementById('darcyFlowRate').textContent = result.flow_rate_stb_per_day.toFixed(2);
            document.getElementById('darcyRadialResult').style.display = 'block';
        } else {
            alert('Error: ' + result.detail);
        }
    } catch (error) {
        alert('Error: ' + error.message);
    }
});

// Gas Deliverability Form
document.getElementById('gasDeliverabilityForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const data = {
        maximum_flow_rate: parseFloat(document.getElementById('max_flow_rate').value),
        test_flow_rate: parseFloat(document.getElementById('test_flow_rate').value),
        flowing_bhp: parseFloat(document.getElementById('flowing_bhp').value),
        reservoir_pressure: parseFloat(document.getElementById('gas_reservoir_pressure').value),
        flow_exponent: parseFloat(document.getElementById('flow_exponent').value)
    };
    
    try {
        const response = await fetch('/api/production/gas_deliverability', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(data)
        });
        
        const result = await response.json();
        
        if (response.ok) {
            document.getElementById('gasFlowRate').textContent = result.flow_rate_mscf_per_day.toFixed(2);
            document.getElementById('gasDeliverabilityResult').style.display = 'block';
        } else {
            alert('Error: ' + result.detail);
        }
    } catch (error) {
        alert('Error: ' + error.message);
    }
});
</script>
{% endblock %}
